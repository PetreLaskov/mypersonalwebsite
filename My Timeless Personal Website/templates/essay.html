<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$if(title)$$title$ - $endif$$if(site-title)$$site-title$$else$Your Name$endif$</title>
    $if(description)$<meta name="description" content="$description$">$endif$
    <meta name="author" content="$if(author)$$author$$else$Your Name$endif$">
    $if(date)$<meta name="date" content="$date$">$endif$
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="$title$">
    $if(description)$<meta property="og:description" content="$description$">$endif$
    $if(url)$<meta property="og:url" content="$url$">$endif$
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/essay.css">
    $if(css)$$for(css)$<link rel="stylesheet" href="$css$">$endfor$$endif$
    
    <!-- Dark mode preference -->
    <script>
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>
    
    $if(math)$
    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    $endif$
</head>
<body>
    <header>
        <nav>
            <a href="/" class="site-title">$if(site-title)$$site-title$$else$Your Name$endif$</a>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/essays" class="active">Essays</a></li>
                <li><a href="/art">Art</a></li>
                <li><a href="/about">About</a></li>
            </ul>
            <button id="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
        </nav>
    </header>

    <main class="essay-container">
        <article class="essay">
            <!-- Essay header -->
            <header class="essay-header">
                <h1 class="essay-title">$title$</h1>
                $if(subtitle)$<h2 class="essay-subtitle">$subtitle$</h2>$endif$
                
                <!-- Essay metadata -->
                <div class="essay-meta">
                    $if(date)$<time datetime="$date$" class="essay-date">$date$</time>$endif$
                    $if(modified)$<span class="essay-modified">Modified: $modified$</span>$endif$
                    $if(reading-time)$<span class="reading-time">$reading-time$ min read</span>$endif$
                    $if(word-count)$<span class="word-count">$word-count$ words</span>$endif$
                </div>
                
                <!-- Tags -->
                $if(tags)$
                <div class="essay-tags">
                    $for(tags)$<span class="tag">$tags$</span>$endfor$
                </div>
                $endif$
                
                <!-- Abstract -->
                $if(abstract)$
                <div class="essay-abstract">
                    <h3>Abstract</h3>
                    <p>$abstract$</p>
                </div>
                $endif$
                
                <!-- Table of Contents -->
                $if(toc)$
                <details class="table-of-contents" open>
                    <summary>Contents</summary>
                    <nav class="toc-nav">
                        $toc$
                    </nav>
                </details>
                $endif$
            </header>

            <!-- Essay body with margin notes area -->
            <div class="essay-content">
                <div class="essay-body">
                    $body$
                </div>
                <aside class="margin-notes" aria-label="Margin notes">
                    <!-- Margin notes will be populated by JavaScript -->
                </aside>
            </div>

            <!-- Footnotes -->
            $if(footnotes)$
            <section class="footnotes">
                <h3>Notes</h3>
                $footnotes$
            </section>
            $endif$
            
            <!-- References -->
            $if(bibliography)$
            <section class="bibliography">
                <h3>References</h3>
                $bibliography$
            </section>
            $endif$

            <!-- Essay footer -->
            <footer class="essay-footer">
                <div class="essay-actions">
                    <button onclick="window.print()" class="action-btn">Print</button>
                    <button onclick="copyLink()" class="action-btn">Share</button>
                    $if(pdf)$<a href="$pdf$" class="action-btn">PDF</a>$endif$
                </div>
                
                $if(related)$
                <section class="related-essays">
                    <h4>Related Essays</h4>
                    <ul>
                        $for(related)$
                        <li><a href="$related.url$">$related.title$</a>$if(related.description)$ - $related.description$$endif$</li>
                        $endfor$
                    </ul>
                </section>
                $endif$
                
                <!-- Discussion/Comments placeholder -->
                <section class="essay-discussion">
                    <h4>Discussion</h4>
                    <p>Comments and discussion welcome via <a href="mailto:your@email.com">email</a>.</p>
                </section>
            </footer>
        </article>
    </main>

    <footer>
        <p>&copy; $if(year)$$year$$else$2025$endif$ $if(author)$$author$$else$Your Name$endif$</p>
        <p><a href="/feed.xml">RSS</a> Â· <a href="/sitemap.xml">Sitemap</a></p>
    </footer>

    <script src="/static/js/main.js"></script>
    <script src="/static/js/essay.js"></script>
</body>
</html>